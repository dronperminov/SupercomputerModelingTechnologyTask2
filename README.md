# SupercomputerModelingTechnologyTask2
Реализация второго практического задания в рамках курса "Суперкомпьютерное моделирование и технологии"

## Программная реализация

Реализовано две программы: последовательная и гибридная параллельная (MPI + OpenMP). Каждая из программ является консольным приложением и принимает входные данные в виде аргументов командной строки. Используются следующие аргументы (доступно при вызове с единственным аргументом `--help`):

* `-d` – отладочный режим (по умолчанию не используется)
* `-Lx` – длина параллелепипеда вдоль оси X (по умолчанию 1)
* `-Ly` – длина параллелепипеда вдоль оси Y (по умолчанию 1)
* `-Lz` – длина параллелепипеда вдоль оси Z (по умолчанию 1)
* `-T` – конечное время сетки (по умолчанию 1)
* `-N` – количество точек пространственной сетки (по умолчанию 40)
* `-K` – количество точек временной сетки (по умолчанию 100)
* `-steps` – количество шагов для решения (по умолчанию 20)
* `-btx` – тип граничного условия вдоль оси X (по умолчанию однородные первого рода)
* `-bty` – тип граничного условия вдоль оси Y (по умолчанию периодические-численные)
* `-btz` – тип граничного условия вдоль оси Z (по умолчанию однородные первого рода)
* `-s` – стратегия разбиения на блоки (по умолчанию блочное, доступно только для MPI версии)
* `-on` – путь к json файлу для сохранения численного решения (по умолчанию не используется)
* `-oa` – путь к json файлу для сохранения аналитического решения (по умолчанию не используется)
* `-od` – путь к json файлу для сохранения погрешности (по умолчанию не используется)
* `-o` – путь к текстовому файлу для вывода результатов (по умолчанию output.txt)

### Типы граничных условий:
* `first-kind (f)` – однородные граничные условия первого рода
* `periodic-analytical (pa)` – аналитические периодические граничные условия
* `periodic-numerical (pn)` – численные периодические граничные условия

### Типы стратегий разбиения
* `blocks (b)` – блочное разбиение
* `tapes (t)` – ленточное разбиение

Для визуализации получаемых решений написан визуализатор (принимает json файлы, генерируемые программой): https://programforyou.ru/tests/supercomputer-modeling-technology/solve-visualizer


## Сборка

Сборки осуществляется через makefile. Для сборки последовательной версии выполните `make main`. Для сборки параллельной версии выполните `make main-mpi`.

### Пример запуска
```bash
>make main
>./main -d -N 64 -K 150 -btx f -bty pa -btz pn -Lx 0.5 -Ly 12.5 -Lz 100
```


### Особенности параллельной реализации

Для распараллеливания вся сетка разбивается на области (также прямоугольные параллелепипеды) в количестве используемых процессов по следующему алгоритму:
* начнём разбиение с параллелепипеда [0, N] x [0, N] x [0, N], выберем начальную ось (X) и запустим рекурсивный процесс
* если текущее количество областей (size) равно 1, вернём обрабатываемый параллелепипед
* если размер нечётный, то по текущей оси выберем область 1 / size и сделаем из неё параллелепипед, и продолжим разбивать область 1 - 1 / size
* по выбранной оси делим область пополам и рекурсивно запускаем для этих подобластей

Для большей наглядности реализован визуализатор разбиения с возможностью установки размера сетки и числа процессов: https://programforyou.ru/tests/supercomputer-modeling-technology/split-visualizer

### Получающиеся разбиения

<table>
    <tr>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split2.png"><br>P=2</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split3.png"><br>P=3</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split4.png"><br>P=4</td>
    </tr>
    <tr>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split5.png"><br>P=5</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split10.png"><br>P=10</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split14.png"><br>P=14</td>
    </tr>
    <tr>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split25.png"><br>P=25</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split30.png"><br>P=30</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/split60.png"><br>P=60</td>
    </tr>
</table>

## Графики аналитического и полученного решений

### Lx = Ly = Lz = 1
<table>
    <tr>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/analytical_1_n128.png"><br>аналитическое</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/numerical_1_n128.png"><br>полученное</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/difference_1_n128.png"><br>погрешность</td>
    </tr>
</table>

### Lx = Ly = Lz = π
<table>
    <tr>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/analytical_pi_n128.png"><br>аналитическое</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/numerical_pi_n128.png"><br>полученное</td>
        <td align="center"><img src="https://github.com/dronperminov/SupercomputerModelingTechnologyTask2/blob/master/examples/difference_pi_n128.png"><br>погрешность</td>
    </tr>
</table>


## Polus (без использования OpenMP)

### Lx = Ly = Lz = 1, N = 128, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           3.63804 |         1 |  0.00541829 |
|                       2 |            2.0889 |     1.742 |  0.00541829 |
|                       4 |           1.23335 |     2.950 |  0.00541829 |
|                       8 |          0.750917 |     4.845 |  0.00541829 |
|                      10 |          0.725553 |     5.014 |  0.00541829 |
|                      16 |          0.457016 |     7.960 |  0.00541829 |
|                      20 |          0.490677 |     7.414 |  0.00541829 |
|                      32 |          0.284132 |    12.804 |  0.00541829 |
|                      40 |          0.292865 |    12.422 |  0.00541829 |
|                      64 |          0.204284 |    17.809 |  0.00541829 |


### Lx = Ly = Lz = 1, N = 256, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           28.1395 |         1 |  0.00542011 |
|                       2 |           15.5112 |     1.814 |  0.00542011 |
|                       4 |           8.91981 |     3.155 |  0.00542011 |
|                       8 |           4.90587 |     5.736 |  0.00542011 |
|                      10 |           5.06664 |     5.554 |  0.00542011 |
|                      16 |           3.47145 |     8.106 |  0.00542011 |
|                      20 |           3.24678 |     8.667 |  0.00542011 |
|                      32 |            2.0451 |    13.759 |  0.00542011 |
|                      40 |           2.06813 |    13.606 |  0.00542011 |
|                      64 |           1.25729 |    22.381 |  0.00542011 |


### Lx = Ly = Lz = 1, N = 512, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |            226.36 |         1 |  0.00542056 |
|                       2 |           126.879 |     1.784 |  0.00542056 |
|                       4 |           68.3944 |     3.310 |  0.00542056 |
|                       4 |           70.8649 |     3.194 |  0.00542056 |
|                       8 |           38.7072 |     5.848 |  0.00542056 |
|                      10 |           36.1188 |     6.267 |  0.00542056 |
|                      16 |           22.4735 |    10.072 |  0.00542056 |
|                      20 |           23.5181 |     9.625 |  0.00542056 |
|                      32 |            16.403 |    13.800 |  0.00542056 |
|                      40 |           14.1878 |    15.955 |  0.00542056 |
|                      64 |           9.11075 |    24.845 |  0.00542056 |

### Lx = Ly = Lz = π, N = 128, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           3.70477 |         1 | 0.000549676 |
|                       2 |           2.05839 |     1.800 | 0.000549676 |
|                       4 |           1.15502 |     3.208 | 0.000549676 |
|                       8 |          0.660539 |     5.609 | 0.000549676 |
|                      10 |          0.792303 |     4.676 | 0.000549676 |
|                      16 |          0.510837 |     7.252 | 0.000549676 |
|                      20 |           0.50147 |     7.388 | 0.000549676 |
|                      32 |          0.280309 |    13.217 | 0.000549676 |
|                      40 |          0.303407 |    12.211 | 0.000549676 |
|                      64 |          0.201278 |    18.406 | 0.000549676 |


### Lx = Ly = Lz = π, N = 256, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           27.8391 |         1 | 0.000549861 |
|                       2 |           15.5066 |     1.795 | 0.000549861 |
|                       4 |           8.81522 |     3.158 | 0.000549861 |
|                       8 |           5.01685 |     5.549 | 0.000549861 |
|                      10 |           4.73172 |     5.884 | 0.000549861 |
|                      16 |           2.95756 |     9.413 | 0.000549861 |
|                      20 |           3.44853 |     8.073 | 0.000549861 |
|                      32 |           2.17926 |    12.775 | 0.000549861 |
|                      40 |           1.78375 |    15.607 | 0.000549861 |
|                      64 |           1.27787 |    21.786 | 0.000549861 |

### Lx = Ly = Lz = π, N = 512, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           224.408 |         1 | 0.000549907 |
|                       2 |           123.547 |     1.816 | 0.000549907 |
|                       4 |           68.1743 |     3.292 | 0.000549907 |
|                       8 |           38.6908 |     5.800 | 0.000549907 |
|                      10 |           36.2742 |     6.186 | 0.000549907 |
|                      16 |            22.888 |     9.805 | 0.000549907 |
|                      20 |           23.4197 |     9.582 | 0.000549907 |
|                      32 |            14.902 |    15.059 | 0.000549907 |
|                      40 |           13.0553 |    17.189 | 0.000549907 |
|                      64 |           9.01731 |    24.886 | 0.000549907 |

## Bluegene

### Lx = Ly = Lz = 1, N = 128, K = 2000

| Число MPI процессов (P) | Время решения (с) | Ускорение | Погрешность |
|                     :-: |               :-: |       :-: |         :-: |
|                       1 |           107.683 |           |  0.00541829 |
|                       2 |           313.807 |           |  0.00541829 |
|                       4 |           438.996 |           |  0.00541829 |
|                       8 |           217.415 |           |  0.00541829 |
|                      16 |           230.718 |           |  0.00541829 |
|                      32 |           125.958 |           |  0.00541829 |
|                      64 |           56.3501 |           |  0.00541829 |
|                     128 |            24.533 |           |  0.00541829 |
|                     256 |           9.87815 |           |  0.00541829 |
